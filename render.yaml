services:
  - type: web
    name: fx-ai-pipeline
    env: python
    plan: free
    region: oregon
    autoDeploy: true

    envVars:
      - key: OPENAI_API_KEY
        fromSecret: true

    healthCheckPath: /healthz
    initialDelaySeconds: 30
    rootDirectory: .
    buildCommand: pip install --upgrade pip && pip install -r requirements.txt
    startCommand: gunicorn --workers 1 --threads 4 --bind 0.0.0.0:$PORT --access-logfile - --error-logfile - ml_pipeline:app

# New cron job to retrain the model every hour
jobs:
  - type: cron
    name: retrain-model
    schedule: "0 * * * *"
    command: |
      curl -s https://fx-ai-pipeline-drcc.onrender.com/train